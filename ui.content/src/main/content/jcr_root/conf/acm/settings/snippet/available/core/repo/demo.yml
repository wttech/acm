group: Repo
name: repo_demo
documentation: |
  Showcase of the `repo` code variable. Creates a folder structure and deletes it again.
  
  Documentation:
    - [Repo](https://github.com/wttech/acm/blob/main/core/src/main/java/dev/vml/es/acm/core/repo/Repo.java)
    - [RepoResource](https://github.com/wttech/acm/blob/main/core/src/main/java/dev/vml/es/acm/core/repo/RepoResource.java)
content: |
  void describeRun() {
    args.bool("dryRun") { value = true; switcher(); description = "Do not commit changes to the repository" }
    args.bool("clean") { value = true; switcher(); description = "Finally delete all created resources" }
  }
    
  boolean canRun() {
    return condition.idleSelf()
  }
    
  void doRun() {
    out.fromLogs()
    repo.autoCommit = args.value("dryRun")
  
    println "Creating a folder structure in the temporary directory of the repository."
    def folder = repo.get("/tmp/acm/demo").ensureFolder()
    for (int i = 0; i < 5; i++) {
      def child = folder.child("child-\${i+1}")
      child.save(["foo": "bar"])
    }
  
    println "Folder '${folder.path}' has now ${folder.descendants().count()} descendant(s)."
  
    if (args.value("clean")) {
      folder.delete()
    }
  }